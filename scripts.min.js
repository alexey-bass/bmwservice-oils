/**
 * @preserve
 * @author Alexey Bass @alexey_bass
 * @copyright 2013-2019
 */
!function(a){function b(){function b(a,b){function c(a){for(var b,c,d=[],e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&57>=b;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}for(var d=c(a),e=c(b),f=0;d[f]&&e[f];f++)if(d[f]!==e[f]){var g=Number(d[f]),h=Number(e[f]);return g==d[f]&&h==e[f]?g-h:d[f]>e[f]?1:-1}return d.length-e.length}var c=!1,d=0,e={},f="//img-fotki.yandex.ru/get/",g="XL";e.init=function(){d=(new Date).getTime(),_loadDb(),$("#warning button").bind("click",function(){var a=(new Date).getTime()-d;a>0&&ga("send","timing","UX","Time before start",a),$("#warning, #screen").hide(),$("#screen").removeClass("hidden").fadeIn(1e3),ga("send","screenview",{screenName:"Main"}),_updateHeight()}),$(a).resize(_updateHeight)},_updateHeight=function(){var b=$(a).height();b>450&&$("#brand ul").height(b-43)},_detectBestImgSize=function(){var b=Math.max($(a).height(),$(a).width());g=700>b?"M":900>b?"L":"XL",$('input[name="image-size"][value='+g+"]").prop("checked",!0)};var h,i,j,k,l,m,n,o,p,q=[],r=[],s=[];_loadDb=function(){var a=(new Date).getTime(),b=$('body script[src*="scripts"]').attr("src"),c=b.replace(/^.+\?/,""),d=-1!==b.indexOf(".min.")?"db.min.json":"db.json";$.ajax({dataType:"json",url:d+"?"+c,cache:!0,success:function(b){var c=(new Date).getTime()-a;c>0&&ga("send","timing","Resources","DB loaded",c),h=_prepareDb(b),_populateSelectors(b),_postInit()}})},_prepareDb=function(a){var b;for(b in a)a[b].id=parseInt(b)+1;return a},_populateSelectors=function(a){var c,d=[],e=[];for(c in a)d.push(a[c].brd),e.push(a[c].sae);d=unique(d).sort(),e=unique(e).sort(b),_populateDiv("brand",d),_populateDiv("sae",e),_populateDiv("tag"),_populateDiv("size"),_attachHandlers(),_detectBestImgSize()},_postInit=function(){j=$("input.type-brand:checkbox ~ span.counter"),k=$("input.type-sae:checkbox ~ span.counter"),l=$("input.type-poly:radio ~ span.counter"),m=$("input.type-clean:radio ~ span.counter"),p=$("input.type-season:radio ~ span.counter"),n=$("input.type-chemical:checkbox ~ span.counter"),allBmwserviceCounters=$("input.type-bmwservice:checkbox ~ span.counter"),o=$("input.type-synth:checkbox ~ span.counter"),_makeDbUsingFilters(),e.updateCounters(),$("#sae .header .title").on("click",function(){$("#sae ul").slideToggle()})},_populateDiv=function(a,b){var c,d="";switch(d+='<div class="header">',d+='<span class="title">',a){case"brand":d+="Бренды";break;case"sae":d+="SAE";break;case"tag":d+="Фильтры";break;case"size":d+="Картинки"}switch(d+="</span>","size"!==a&&(d+='<span class="link float-right select-none type-'+a+'" title="Снять все галочки">Очистить</span>'),d+="</div>",d+='<ul class="clear">',a){case"tag":d+="<li>",d+="<label>",d+='<input type="checkbox" class="filter type-poly" value="">',d+=' <span class="color-'+a+'">полимеризация</span>',d+="</label>",d+="</li>",d+='<li class="color-'+a+' poly-row">',d+='<label class="disabled">',d+='<input type="radio" name="poly" class="filter type-poly" value="1" disabled="disabled">',d+=' <span class="label">да</span>',d+=' <span class="counter" value="poly-1"></span>',d+="</label>",d+="<br/>",d+='<label class="disabled">',d+='<input type="radio" name="poly" class="filter type-poly" value="0"  disabled="disabled">',d+=' <span class="label">нет</span>',d+=' <span class="counter" value="poly-0"></span>',d+="</label>",d+="</li>",d+="<li>",d+="<label>",d+='<input type="checkbox" class="filter type-clean" value="">',d+=' <span class="color-'+a+'">чистый результат</span>',d+="</label>",d+="</li>",d+='<li class="color-'+a+' clean-row">',d+='<label class="disabled">',d+='<input type="radio" name="clean" class="filter type-clean" value="1" disabled="disabled">',d+=' <span class="label">да</span>',d+=' <span class="counter" value="clean-1"></span>',d+="</label>",d+="<br/>",d+='<label class="disabled">',d+='<input type="radio" name="clean" class="filter type-clean" value="0"  disabled="disabled">',d+=' <span class="label">нет</span>',d+=' <span class="counter" value="clean-0"></span>',d+="</label>",d+="</li>",d+="<li>",d+="<label>",d+='<input type="checkbox" class="filter type-chemical" value="">',d+=' <span class="color-'+a+'" title="Есть результат из лаборатории">хим. анализ</span>',d+=' <span class="counter" value="chemical-1"></span>',d+="</label>",d+="</li>",d+="<li>",d+="<label>",d+='<input type="checkbox" class="filter type-synth" value="">',d+=' <span class="color-'+a+'" title="Скрыть минеральные и полусинтетику">синтетика</span>',d+=' <span class="counter" value="synth"></span>',d+="</label>",d+="</li>",d+="<li>",d+="<label>",d+='<input type="checkbox" class="filter type-bmwservice" value="">',d+=' <span class="color-'+a+'" title="Рекомендованные моторные масла bmwservice">bmwservice</span>',d+=' <span class="counter" value="bmwservice"></span>',d+="</label>",d+="</li>",d+="<li>",d+='<label title="Сезон прожарки">',d+='<input type="checkbox" class="filter type-season" value="">',d+=' <span class="color-'+a+'">сезон</span>',d+="</label>",d+="</li>",d+='<li class="color-'+a+' season-row">',d+='<label class="disabled">',d+='<input type="radio" name="season" class="filter type-season" value="1" disabled="disabled">',d+=' <span class="label" >1 (2013)</span>',d+=' <span class="counter" value="season-1"></span>',d+="</label>",d+="<br/>",d+='<label class="disabled">',d+='<input type="radio" name="season" class="filter type-season" value="2"  disabled="disabled">',d+=' <span class="label">2 (2019, скоро!)</span>',d+=' <span class="counter" value="season-2"></span>',d+="</label>",d+="</li>";break;case"size":d+='<label title="быстро грузятся на смартфоне"><input type="radio" name="image-size" value="M" /> маленькие</label><br/>',d+='<label><input type="radio" name="image-size" value="L" /> средние</label><br/>',d+='<label><input type="radio" name="image-size" value="XL" /> большие</label><br/>',d+='<label title="хороши для просмотра на широкоформатных мониторах"><input type="radio" name="image-size" value="XXL"> ещё больше</label><br/>';break;default:for(c in b){switch(d+="<li>",d+="<label>",d+='<input type="checkbox" class="filter type-'+a+'" value="'+b[c]+'">',d+=' <span class="label color-'+a+'">',a){case"sae":d+=b[c].replace("w","w-");break;case"brand":d+=b[c]}d+="</span>",d+=' <span class="counter" value="'+b[c]+'"></span>',d+="</label>",d+="</li>"}}d+="</ul>",$("#"+a).html(d)},_attachHandlers=function(){$("input.filter").bind("change",function(){_updateFilters($(this))}),$("span.select-none").bind("click",function(){_uncheckGroup($(this))}),$(document).on("click","span.chemical",function(){_openChemicalWindow($(this))}),$(document).on("click","#show-all",function(){ga("send","event","UX","Show all"),e.rebuildResults(!0)}),$('input[name="image-size"]').on("change",function(){g=_getImageSize(),ga("send","event","UX","Image size",g),e.rebuildResults(!0)}),"undefined"!=typeof addthis&&(addthis.addEventListener("addthis.ready",_addthisHandler),addthis.addEventListener("addthis.menu.share",_addthisHandler))};var t=0;_addthisHandler=function(a){var b=(new Date).getTime()-d;switch(a.type){case"addthis.ready":ga("send","timing","Resources","AddThis ready",b);break;case"addthis.menu.share":ga("send","event","social","share",a.data.service,++t),ga("send","timing","UX","Time before pressed share",b,a.data.service)}},_getImageSize=function(){return $('input[name="image-size"]:checked').val()};var u='<html><head><meta charset="utf-8"><title>%TITLE%</title><link rel="stylesheet" href="css/normalize.css"><style>body{margin:0;padding:0;font-size:10pt}</style></head><body><div style="padding: 0 10px"><p>%TEXT%</p><p style="font-size:7pt">Внимание: для определения щёлочности используется не ASTM-D2896, а более близкий к нашему ГОСТ - ASTM D4739, который дает около 15% занижения щелочного числа. Следовательно, показатели TBN несколько занижены относительно паспортных.<br/>Исследование в закрытом тигле обычно производится для легких нефтепродуктов - этот тест пропорционально занижает точку вспышки на величину около 20 градусов.<p></div><div><img src="%IMG%" alt="" /></div></body></html>';return _openChemicalWindow=function(b){var c=b.attr("dbid"),d=_getDbItemById(c),e=a.open("","_blank","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,height=900,width=820"),g=d.brd+" "+d.prd+" SAE "+d.sae.replace("w","W-");ga("send","event","UX","Open chemical report",g);var h=u;h=h.replace("%TITLE%",g),h=h.replace("%TEXT%",d.chm.txt),h=h.replace("%IMG%",f+d.chm.img+"_XXL"),e.document.write(h)},_getDbItemById=function(a){return h[a-1]},_updateFilters=function(a){if(c)var b=(new Date).getTime();var d,f=a.is("input"),g=a.is("[type=radio]"),h=a.is(":checked");switch(a.attr("class").match(/type-(\w+)/)[1]){case"brand":f&&ga("send","event","UX",(h?"S":"Uns")+"elect brand",a.val()),d=q;break;case"sae":f&&ga("send","event","UX",(h?"S":"Uns")+"elect SAE",a.val()),d=r;break;case"poly":f&&(g?ga("send","event","UX","Filter poly",parseInt(a.val())?"Yes":"No"):ga("send","event","UX","Filter poly",h?"Enabled":"Disabled"),$("input[name=poly]:radio").prop("disabled",!h),l.parent()[h?"removeClass":"addClass"]("disabled")),d=[];break;case"clean":f&&(g?ga("send","event","UX","Filter clean result",parseInt(a.val())?"Yes":"No"):ga("send","event","UX","Filter clean result",h?"Enabled":"Disabled"),$("input[name=clean]:radio").prop("disabled",!h),m.parent()[h?"removeClass":"addClass"]("disabled")),d=[];break;case"season":f&&(g?ga("send","event","UX","Filter season result",parseInt(a.val())):ga("send","event","UX","Filter season result",h?"Enabled":"Disabled"),$("input[name=season]:radio").prop("disabled",!h),p.parent()[h?"removeClass":"addClass"]("disabled")),d=[];break;case"synth":ga("send","event","UX","Filter synt only",h?"Enabled":"Disabled"),_disableMineralLabels(h),d=[];break;case"chemical":ga("send","event","UX","Filter has chemical result",h?"Enabled":"Disabled"),d=[];break;case"bmwservice":ga("send","event","UX","Filter bmwservice recommended",h?"Enabled":"Disabled"),d=[];break;default:d=[]}f?h?d.push(a.val()):-1!==d.indexOf(a.val())&&remove(d,d.indexOf(a.val())):d.length=0,_makeDbUsingFilters(),e.rebuildResults(),e.updateCounters(),c&&console.log((new Date).getTime()-b+" ms")},_disableMineralLabels=function(a){k.parent().has("input[value=10w40], input[value=15w40]").children("input").prop("disabled",a)},e.rebuildResults=function(a){a=a||!1;var b=a||q.length||r.length||_filterPolyEnabled()||_filterCleanEnabled()||_filterSeasonEnabled()?!1:!0;if(b)return $("#results").html(""),void $("#show-all").removeClass("hidden");var c,d="";for(c in s)d+=_makeResultItem(s[c]);$("#results").html(d),$("#show-all").addClass("hidden")},e.updateCounters=function(){var a,b;j.html(""),j.parent().addClass("disabled");for(a in i.brand)j.filter('[value="'+a+'"]').html(i.brand[a]).parent().removeClass("disabled");k.html(""),k.parent().addClass("disabled");for(a in i.sae)k.filter('[value="'+a+'"]').html(i.sae[a]).parent().removeClass("disabled");b=i.poly[0]+i.poly[1],l.filter("[value=poly-1]").html(i.poly[1]?i.poly[1]+" ("+Math.round(100*i.poly[1]/b)+"%)":""),l.filter("[value=poly-0]").html(i.poly[0]?i.poly[0]+" ("+Math.round(100*i.poly[0]/b)+"%)":""),p.filter("[value=season-1]").html(i.season[1]||""),p.filter("[value=season-2]").html(i.season[2]||""),n.html(i.chemical||""),allBmwserviceCounters.html(i.bmwservice||""),o.html(i.synth||"")},_filterPolyEnabled=function(){return $("input.type-poly:checkbox").prop("checked")&&$("input[name=poly]:radio:checked").prop("checked")},_filterCleanEnabled=function(){return $("input.type-clean:checkbox").prop("checked")&&$("input[name=clean]:radio:checked").prop("checked")},_filterSeasonEnabled=function(){return $("input.type-season:checkbox").prop("checked")&&$("input[name=season]:radio:checked").prop("checked")},_filterChemicalEnabled=function(){return $("input.type-chemical:checkbox").prop("checked")},_filterBmwserviceEnabled=function(){return $("input.type-bmwservice:checkbox").prop("checked")},_filterSynthEnabled=function(){return $("input.type-synth:checkbox").prop("checked")},_makeDbUsingFilters=function(){var a;s=[],i={brand:{},sae:{},poly:{0:0,1:0},clean:{0:0,1:0},season:{1:0,2:0},chemical:0,bmwservice:0,synth:0};var b=_filterPolyEnabled(),c=parseInt($("input[name=poly]:radio:checked").val()),d=_filterCleanEnabled(),e=parseInt($("input[name=clean]:radio:checked").val()),f=_filterSeasonEnabled(),g=parseInt($("input[name=season]:radio:checked").val()),j=_filterChemicalEnabled(),k=_filterBmwserviceEnabled(),l=_filterSynthEnabled();for(a in h)b&&(h[a].ply||0)!==c||d&&(h[a].cln||0)!==e||f&&(h[a].ssn||1)!==g||l&&0===h[a].syn||(!j||h[a].chm)&&(!k||h[a].rbs)&&(q.length&&q.indexOf(h[a].brd)<0||r.length&&r.indexOf(h[a].sae)<0||(s.push(h[a]),i.brand[h[a].brd]?i.brand[h[a].brd]++:i.brand[h[a].brd]=1,i.sae[h[a].sae]?i.sae[h[a].sae]++:i.sae[h[a].sae]=1,i.poly[h[a].ply||0]++,i.clean[h[a].cln||0]++,i.season[h[a].ssn||1]++,h[a].chm?i.chemical++:0,h[a].rbs?i.bmwservice++:0,0!==h[a].syn?i.synth++:0));$("#notes").html("&nbsp;Нашлось: "+s.length+'<br/>&nbsp;<span id="show-all" class="link blue hidden">Показать</span>')},_makeResultItem=function(a){var b="";if(b+='<div class="result-item">',b+="<h3>",b+='<span class="color-brand">'+a.brd+"</span> "+a.prd+' <span class="color-sae">SAE '+a.sae.replace("w","W-")+"</span>",a.chm&&(b+='&nbsp;&nbsp;&nbsp;<span class="link blue chemical" dbid="'+a.id+'">Анализ</span>'),a.links)for(var c in a.links)b+='&nbsp;&nbsp;&nbsp;<a href="'+a.links[c].hrf+'" onclick="window.open(this.href); return false;">'+a.links[c].ttl+"</a>";return b+="</h3>",b+="<p>"+a.txt+"</p>",b+='<img src="'+f+a.img+"_"+g+'" />',b+="</div>"},_uncheckGroup=function(a){var b=a.parents("div.group").attr("id");ga("send","event","UX","Clear all",b),a.parents("div.group").find("input.filter:checked").prop("checked",!1),"tag"===b&&($("input[name=poly]:radio").prop("checked",!1).prop("disabled",!0),l.parent().addClass("disabled"),$("input[name=clean]:radio").prop("checked",!1).prop("disabled",!0),m.parent().addClass("disabled"),$("input[name=season]:radio").prop("checked",!1).prop("disabled",!0),p.parent().addClass("disabled"),_disableMineralLabels(!1)),_updateFilters(a)},unique=function(a){return $.grep(a,function(b,c){return c===$.inArray(b,a)})},intersect=function(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(a[d]==b[e]){c.push(a[d]);break}return c},remove=function(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=0>b?a.length+b:b,a.push.apply(a,d)},naturalSort=function(a,b){return+/\d+/.exec(a)[0]>+/\d+/.exec(b)[0]},e}a.App=b()}(window),$(document).ready(function(){App.init()});