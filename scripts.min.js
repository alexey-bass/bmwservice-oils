/**
 * @preserve
 * @author Alexey Bass @alexey_bass
 * @copyright 2013-2019
 */
!function(a,b){function c(){function c(a,b){function c(a){for(var b,c,d=[],e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&57>=b;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}for(var d=c(a),e=c(b),f=0;d[f]&&e[f];f++)if(d[f]!==e[f]){var g=Number(d[f]),h=Number(e[f]);return g==d[f]&&h==e[f]?g-h:d[f]>e[f]?1:-1}return d.length-e.length}var d=!1,e=0,f={},g="//img-fotki.yandex.ru/get/",h="XL";f.init=function(){e=(new Date).getTime(),_loadDb(),b("#warning button").bind("click",function(){var a=(new Date).getTime()-e;a>0&&gtag("event","timing_complete",{name:"Time before start",value:a,event_category:"UX"}),b("#warning, #screen").hide(),b("#screen").removeClass("hidden").fadeIn(1e3),gtag("event","screen_view",{app_name:"bmwservice-oils",screen_name:"Main"})})},_detectBestImgSize=function(){var c=Math.max(b(a).height(),b(a).width());h=700>c?"M":900>c?"L":"XL",b('input[name="image-size"][value='+h+"]").prop("checked",!0)};var i,j,k,l,m,n,o,p,q,r,s=[],t=[],u=[];_loadDb=function(){var a=(new Date).getTime(),c=b('body script[src*="scripts"]').attr("src"),d=c.replace(/^.+\?/,""),e=-1!==c.indexOf(".min.")?"db.min.json":"db.json";b.ajax({dataType:"json",url:e+"?"+d,cache:!0,success:function(b){var c=(new Date).getTime()-a;c>0&&gtag("event","timing_complete",{name:"DB loaded",value:c,event_category:"Resources"}),i=_prepareDb(b),_populateSelectors(b),_postInit()}})},_prepareDb=function(a){var b;for(b in a)a[b].id=parseInt(b)+1;return a},_populateSelectors=function(a){var b,d=[],e=[];for(b in a)d.push(a[b].brd),e.push(a[b].sae);d=unique(d).sort(),e=unique(e).sort(c),_populateDiv("brand",d),_populateDiv("sae",e),_populateDiv("tag"),_populateDiv("size"),_attachHandlers(),_detectBestImgSize()},_postInit=function(){k=b("input.type-brand:checkbox ~ span.counter"),l=b("input.type-sae:checkbox ~ span.counter"),m=b("input.type-poly:radio ~ span.counter"),n=b("input.type-clean:radio ~ span.counter"),q=b("input.type-season:radio ~ span.counter"),o=b("input.type-chemical:checkbox ~ span.counter"),r=b("input.type-bmwservice:checkbox ~ span.counter"),p=b("input.type-synth:checkbox ~ span.counter"),_makeDbUsingFilters(),f.updateCounters(),b("#sae .header .title").on("click",function(){b("#sae ul").slideToggle()})},_populateDiv=function(a,c){var d,e="";switch(e+='<div class="header">',e+='<span class="title">',a){case"brand":e+="Бренды";break;case"sae":e+="SAE";break;case"tag":e+="Фильтры";break;case"size":e+="Картинки"}switch(e+="</span>","size"!==a&&(e+='<span class="link float-right select-none type-'+a+'" title="Снять все галочки">Очистить</span>'),e+="</div>",e+='<ul class="clear">',a){case"tag":e+="<li>",e+="<label>",e+='<input type="checkbox" class="filter type-poly" value="">',e+=' <span class="color-'+a+'">полимеризация</span>',e+="</label>",e+="</li>",e+='<li class="color-'+a+' poly-row">',e+='<label class="disabled">',e+='<input type="radio" name="poly" class="filter type-poly" value="1" disabled="disabled">',e+=' <span class="label">да</span>',e+=' <span class="counter" value="poly-1"></span>',e+="</label>",e+="<br/>",e+='<label class="disabled">',e+='<input type="radio" name="poly" class="filter type-poly" value="0"  disabled="disabled">',e+=' <span class="label">нет</span>',e+=' <span class="counter" value="poly-0"></span>',e+="</label>",e+="</li>",e+="<li>",e+="<label>",e+='<input type="checkbox" class="filter type-clean" value="">',e+=' <span class="color-'+a+'">чистый результат</span>',e+="</label>",e+="</li>",e+='<li class="color-'+a+' clean-row">',e+='<label class="disabled">',e+='<input type="radio" name="clean" class="filter type-clean" value="1" disabled="disabled">',e+=' <span class="label">да</span>',e+=' <span class="counter" value="clean-1"></span>',e+="</label>",e+="<br/>",e+='<label class="disabled">',e+='<input type="radio" name="clean" class="filter type-clean" value="0"  disabled="disabled">',e+=' <span class="label">нет</span>',e+=' <span class="counter" value="clean-0"></span>',e+="</label>",e+="</li>",e+="<li>",e+="<label>",e+='<input type="checkbox" class="filter type-chemical" value="">',e+=' <span class="color-'+a+'" title="Есть результат из лаборатории">хим. анализ</span>',e+=' <span class="counter" value="chemical-1"></span>',e+="</label>",e+="</li>",e+="<li>",e+="<label>",e+='<input type="checkbox" class="filter type-synth" value="">',e+=' <span class="color-'+a+'" title="Скрыть минеральные и полусинтетику">синтетика</span>',e+=' <span class="counter" value="synth"></span>',e+="</label>",e+="</li>",e+="<li>",e+="<label>",e+='<input type="checkbox" class="filter type-bmwservice" value="">',e+=' <span class="color-'+a+'" title="Рекомендованные моторные масла bmwservice">bmwservice</span>',e+=' <span class="counter" value="bmwservice"></span>',e+="</label>",e+="</li>",e+="<li>",e+='<label title="Сезон прожарки">',e+='<input type="checkbox" class="filter type-season" value="">',e+=' <span class="color-'+a+'">сезон</span>',e+="</label>",e+="</li>",e+='<li class="color-'+a+' season-row">',e+='<label class="disabled">',e+='<input type="radio" name="season" class="filter type-season" value="1" disabled="disabled">',e+=' <span class="label" >1 (2013)</span>',e+=' <span class="counter" value="season-1"></span>',e+="</label>",e+="<br/>",e+='<label class="disabled">',e+='<input type="radio" name="season" class="filter type-season" value="2"  disabled="disabled">',e+=' <span class="label">2 (2019, скоро!)</span>',e+=' <span class="counter" value="season-2"></span>',e+="</label>",e+="</li>";break;case"size":e+='<label title="быстро грузятся на смартфоне"><input type="radio" name="image-size" value="M" /> маленькие</label><br/>',e+='<label><input type="radio" name="image-size" value="L" /> средние</label><br/>',e+='<label><input type="radio" name="image-size" value="XL" /> большие</label><br/>',e+='<label title="хороши для просмотра на широкоформатных мониторах"><input type="radio" name="image-size" value="XXL"> огромные</label><br/>';break;default:for(d in c){switch(e+="<li>",e+="<label>",e+='<input type="checkbox" class="filter type-'+a+'" value="'+c[d]+'">',e+=' <span class="label color-'+a+'">',a){case"sae":e+=c[d].replace("w","w-");break;case"brand":e+=c[d]}e+="</span>",e+=' <span class="counter" value="'+c[d]+'"></span>',e+="</label>",e+="</li>"}}e+="</ul>",b("#"+a).html(e)},_attachHandlers=function(){b("input.filter").bind("change",function(){_updateFilters(b(this))}),b("span.select-none").bind("click",function(){_uncheckGroup(b(this))}),b(document).on("click","span.chemical",function(){_openChemicalWindow(b(this))}),b(document).on("click","#show-all",function(){gtag("event","Show all",{event_category:"UX"}),f.rebuildResults(!0)}),b('input[name="image-size"]').on("change",function(){h=_getImageSize(),gtag("event","Image size",{event_category:"UX",event_label:h}),f.rebuildResults(!0)}),"undefined"!=typeof addthis&&(addthis.addEventListener("addthis.ready",_addthisHandler),addthis.addEventListener("addthis.menu.share",_addthisHandler))};var v=0;_addthisHandler=function(a){var b=(new Date).getTime()-e;switch(a.type){case"addthis.ready":gtag("event","timing_complete",{name:"AddThis ready",value:b,event_category:"Resources"});break;case"addthis.menu.share":gtag("event","share",{event_category:"social",event_label:a.data.service,value:++v}),gtag("event","timing_complete",{name:"Time before pressed share",value:b,event_category:"UX",event_label:a.data.service})}},_getImageSize=function(){return b('input[name="image-size"]:checked').val()};var w='<html lang="ru"><head><meta charset="utf-8"><title>%TITLE%</title><link rel="stylesheet" href="css/normalize.css"><style>body{margin:0;padding:0;font-size:10pt}</style></head><body><div style="padding: 0 10px"><p>%TEXT%</p><p style="font-size:7pt">Внимание: для определения щёлочности используется не ASTM-D2896, а более близкий к нашему ГОСТ - ASTM D4739, который дает около 15% занижения щелочного числа. Следовательно, показатели TBN несколько занижены относительно паспортных.<br/>Исследование в закрытом тигле обычно производится для легких нефтепродуктов - этот тест пропорционально занижает точку вспышки на величину около 20 градусов.<p></div><div><img src="%IMG%" alt="" /></div></body></html>';return _openChemicalWindow=function(b){var c=b.attr("dbid"),d=_getDbItemById(c),e=a.open("","_blank","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,height=900,width=820"),f=d.brd+" "+d.prd+" SAE "+d.sae.replace("w","W-");gtag("event","Open chemical report",{event_category:"UX",event_label:f});var h=w;h=h.replace("%TITLE%",f),h=h.replace("%TEXT%",d.chm.txt),h=h.replace("%IMG%",g+d.chm.img+"_XXL"),e.document.write(h)},_getDbItemById=function(a){return i[a-1]},_updateFilters=function(a){if(d)var c=(new Date).getTime();var e,g=a.is("input"),h=a.is("[type=radio]"),i=a.is(":checked");switch(a.attr("class").match(/type-(\w+)/)[1]){case"brand":g&&gtag("event",(i?"S":"Uns")+"elect brand",{event_category:"UX",event_label:a.val()}),e=s;break;case"sae":g&&gtag("event",(i?"S":"Uns")+"elect SAE",{event_category:"UX",event_label:a.val()}),e=t;break;case"poly":g&&(h?gtag("event","Filter poly",{event_category:"UX",event_label:parseInt(a.val())?"Yes":"No"}):gtag("event","Filter poly",{event_category:"UX",event_label:i?"Enabled":"Disabled"}),b("input[name=poly]:radio").prop("disabled",!i),m.parent()[i?"removeClass":"addClass"]("disabled")),e=[];break;case"clean":g&&(h?gtag("event","Filter clean result",{event_category:"UX",event_label:parseInt(a.val())?"Yes":"No"}):gtag("event","Filter clean result",{event_category:"UX",event_label:i?"Enabled":"Disabled"}),b("input[name=clean]:radio").prop("disabled",!i),n.parent()[i?"removeClass":"addClass"]("disabled")),e=[];break;case"season":g&&(h?gtag("event","Filter season result",{event_category:"UX",event_label:parseInt(a.val())}):gtag("event","Filter season result",{event_category:"UX",event_label:i?"Enabled":"Disabled"}),b("input[name=season]:radio").prop("disabled",!i),q.parent()[i?"removeClass":"addClass"]("disabled")),e=[];break;case"synth":gtag("event","Filter synt only",{event_category:"UX",event_label:i?"Enabled":"Disabled"}),_disableMineralLabels(i),e=[];break;case"chemical":gtag("event","Filter has chemical result",{event_category:"UX",event_label:i?"Enabled":"Disabled"}),e=[];break;case"bmwservice":gtag("event","Filter bmwservice recommended",{event_category:"UX",event_label:i?"Enabled":"Disabled"}),e=[];break;default:e=[]}g?i?e.push(a.val()):-1!==e.indexOf(a.val())&&remove(e,e.indexOf(a.val())):e.length=0,_makeDbUsingFilters(),f.rebuildResults(),f.updateCounters(),d&&console.log((new Date).getTime()-c+" ms")},_disableMineralLabels=function(a){l.parent().has("input[value=10w40], input[value=15w40]").children("input").prop("disabled",a)},f.rebuildResults=function(a){a=a||!1;var c=!(a||s.length||t.length||_filterPolyEnabled()||_filterCleanEnabled()||_filterSeasonEnabled());if(c)return b("#results").html(""),void b("#show-all").removeClass("hidden");var d,e="";for(d in u)e+=_makeResultItem(u[d]);b("#results").html(e),b("#show-all").addClass("hidden")},f.updateCounters=function(){var a,b;k.html(""),k.parent().addClass("disabled");for(a in j.brand)k.filter('[value="'+a+'"]').html(j.brand[a]).parent().removeClass("disabled");l.html(""),l.parent().addClass("disabled");for(a in j.sae)l.filter('[value="'+a+'"]').html(j.sae[a]).parent().removeClass("disabled");b=j.poly[0]+j.poly[1],m.filter("[value=poly-1]").html(j.poly[1]?j.poly[1]+" ("+Math.round(100*j.poly[1]/b)+"%)":""),m.filter("[value=poly-0]").html(j.poly[0]?j.poly[0]+" ("+Math.round(100*j.poly[0]/b)+"%)":""),n.filter("[value=clean-1]").html(j.clean[1]||""),n.filter("[value=clean-0]").html(j.clean[0]||""),q.filter("[value=season-1]").html(j.season[1]||""),q.filter("[value=season-2]").html(j.season[2]||""),o.html(j.chemical||""),r.html(j.bmwservice||""),p.html(j.synth||"")},_filterPolyEnabled=function(){return b("input.type-poly:checkbox").prop("checked")&&b("input[name=poly]:radio:checked").prop("checked")},_filterCleanEnabled=function(){return b("input.type-clean:checkbox").prop("checked")&&b("input[name=clean]:radio:checked").prop("checked")},_filterSeasonEnabled=function(){return b("input.type-season:checkbox").prop("checked")&&b("input[name=season]:radio:checked").prop("checked")},_filterChemicalEnabled=function(){return b("input.type-chemical:checkbox").prop("checked")},_filterBmwserviceEnabled=function(){return b("input.type-bmwservice:checkbox").prop("checked")},_filterSynthEnabled=function(){return b("input.type-synth:checkbox").prop("checked")},_makeDbUsingFilters=function(){var a;u=[],j={brand:{},sae:{},poly:{0:0,1:0},clean:{0:0,1:0},season:{1:0,2:0},chemical:0,bmwservice:0,synth:0};var c=_filterPolyEnabled(),d=parseInt(b("input[name=poly]:radio:checked").val()),e=_filterCleanEnabled(),f=parseInt(b("input[name=clean]:radio:checked").val()),g=_filterSeasonEnabled(),h=parseInt(b("input[name=season]:radio:checked").val()),k=_filterChemicalEnabled(),l=_filterBmwserviceEnabled(),m=_filterSynthEnabled();for(a in i)c&&(i[a].ply||0)!==d||e&&(i[a].cln||0)!==f||g&&(i[a].ssn||1)!==h||m&&0===i[a].syn||(!k||i[a].chm)&&(!l||i[a].rbs)&&(s.length&&s.indexOf(i[a].brd)<0||t.length&&t.indexOf(i[a].sae)<0||(u.push(i[a]),j.brand[i[a].brd]?j.brand[i[a].brd]++:j.brand[i[a].brd]=1,j.sae[i[a].sae]?j.sae[i[a].sae]++:j.sae[i[a].sae]=1,j.poly[i[a].ply||0]++,j.clean[i[a].cln||0]++,j.season[i[a].ssn||1]++,i[a].chm?j.chemical++:0,i[a].rbs?j.bmwservice++:0,0!==i[a].syn?j.synth++:0));b("#notes").html("&nbsp;Нашлось: "+u.length+'<br/>&nbsp;<span id="show-all" class="link blue hidden">Показать</span>')},_makeResultItem=function(a){var b="";if(b+='<div class="result-item">',b+="<h3>",b+='<span class="color-brand">'+a.brd+"</span> "+a.prd+' <span class="color-sae">SAE '+a.sae.replace("w","W-")+"</span>",a.chm&&(b+='&nbsp;&nbsp;&nbsp;<span class="link blue chemical" dbid="'+a.id+'">Анализ</span>'),a.links)for(var c in a.links)b+='&nbsp;&nbsp;&nbsp;<a href="'+a.links[c].hrf+'" onclick="window.open(this.href); return false;">'+a.links[c].ttl+"</a>";return b+="</h3>",b+="<p>"+a.txt+"</p>",b+='<img src="'+g+a.img+"_"+h+'" />',b+="</div>"},_uncheckGroup=function(a){var c=a.parents("div.group").attr("id");gtag("event","Clear all",{event_category:"UX",event_label:c}),a.parents("div.group").find("input.filter:checked").prop("checked",!1),"tag"===c&&(b("input[name=poly]:radio").prop("checked",!1).prop("disabled",!0),m.parent().addClass("disabled"),b("input[name=clean]:radio").prop("checked",!1).prop("disabled",!0),n.parent().addClass("disabled"),b("input[name=season]:radio").prop("checked",!1).prop("disabled",!0),q.parent().addClass("disabled"),_disableMineralLabels(!1)),_updateFilters(a)},unique=function(a){return b.grep(a,function(c,d){return d===b.inArray(c,a)})},intersect=function(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(a[d]==b[e]){c.push(a[d]);break}return c},remove=function(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=0>b?a.length+b:b,a.push.apply(a,d)},naturalSort=function(a,b){return+/\d+/.exec(a)[0]>+/\d+/.exec(b)[0]},f}a.App=c()}(window,window.jQuery),$(document).ready(function(){App.init()});